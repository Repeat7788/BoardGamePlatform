fetch("https://repeat-taxi.app.n8n.cloud/webhook/group-register", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    userId: profile.userId,
    displayName: profile.displayName,
    email: params.email,
    course_id: params.courseId,
    dt: new Date().toISOString()
  })
}).then(res => {
  if (res.ok) {
    document.getElementById('status').innerHTML = 
      '<div class="success">報名成功！<br>可回官方帳號輸入<br>「桌遊揪團」查看目前揪團人數</div>';
    document.querySelector('.tips').textContent = '此視窗將自動關閉，如未自動關閉可直接手動關閉';
    setTimeout(() => { liff.closeWindow(); }, 1800);
  } else {
    throw new Error('Webhook異常');
  }
}).catch(err => {
  document.getElementById('status').innerHTML =
    '<b style="color:#e02c2c">綁定失敗，請稍後再試或聯絡客服</b>';
});
