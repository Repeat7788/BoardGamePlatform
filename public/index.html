<!doctype html>
<html lang="zh-TW">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>äººé¡åœ–æ¡ŒéŠã€Œæœªä¾†å°èˆªã€æªåœ˜ç¥å™¨</title>
Â  <style>
Â  Â  /* æ‚¨çš„è‡ªè¨‚ CSS æ¨£å¼å®Œå…¨ä¿ç•™ */
Â  Â  body { background: linear-gradient(135deg, #0f4392 0%, #6393d1 100%);
Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
Â  Â  Â  min-height: 100vh; }
Â  Â  .container { max-width:900px; width:100%; margin:2rem auto;
Â  Â  Â  background:#fff; border-radius:20px; box-shadow:0 20px 60px #0004; overflow:hidden;}
Â  Â  .header { background: linear-gradient(135deg,#0f4392 0%,#6393d1 100%);
Â  Â  Â  color:#fff;padding:2.5rem 2rem;}
Â  Â  .header-content{ display:flex; align-items:center; justify-content:center; gap:2.5rem; margin-bottom:1.5rem;}
Â  Â  .logo-image { width:120px; height:120px; object-fit:cover; border-radius:14px; box-shadow:0 2px 8px #0f43924d; }
Â  Â  .title-section h1 { margin:0;font-size:2rem;font-weight:700;text-align:left;}
Â  Â  .description { margin:0 0 1rem 0; font-size:1rem; opacity:.95; max-width:600px; margin-left:auto; margin-right:auto;
Â  Â  Â  line-height:1.6; background:rgba(255,255,255,0.1); padding:1rem 1.5rem; border-radius:12px;}
Â  Â  .subtitle { margin:0; font-size:.98rem; opacity:.88; font-style:italic; text-align: center;}
Â  Â  .updatetime{margin-top:1.2em;font-size:.98em;color:#fff;opacity:.94;font-weight:600; text-align: center;}
Â  Â  .content {padding:2rem;}
Â  Â  .process-section{background:#fff;border-radius:16px;padding:2rem;margin-bottom:2rem;border:2px solid #eeba2b;box-shadow:0 4px 20px #eeba2b26;}
Â  Â  .process-title{color:#112947;font-size:1.5rem;font-weight:700;text-align:center;margin:0 0 1.5rem 0;}
Â  Â  .process-steps{display:flex;justify-content:space-between;align-items:stretch;gap:1rem;}
Â  Â  .step{flex:1;display:flex;flex-direction:column;align-items:center;text-align:center;background:#f8e185;padding:1.5rem 1rem;border-radius:12px;border:1px solid #eeba2b;}
Â  Â  .step-number{background:#0f4392;color:#fff;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.25rem;margin-bottom:1rem;}
Â  Â  .step-content h3{color:#112947;font-size:1.1rem;font-weight:600;margin:0 0 0.75rem 0;}
Â  Â  .step-content p{color:#112947;font-size:0.9rem;line-height:1.4;margin:0;opacity:.8;}
Â  Â  .course-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem;}
Â  Â  .course-card{background:#fff;border-radius:12px;padding:1.5rem;border:2px solid #b6ccd7;transition:all 0.3s;}
Â  Â  .course-card:hover{transform:translateY(-4px);box-shadow:0 8px 20px #0f439233;border-color:#6393d1;}
Â  Â  .course-time{font-size:1.25rem;font-weight:700;color:#112947;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem;}
Â  Â  .participant-count{display:flex;align-items:center;gap:0.5rem;margin-bottom:1rem;font-size:1rem;color:#112947;}
Â  Â  .count-number{font-size:1.5rem;font-weight:700;color:#0f4392;}
Â  Â  .status-badge{display:inline-block;padding:0.5rem 1rem;border-radius:20px;font-size:0.875rem;font-weight:600;margin-bottom:1rem;}
Â  Â  .status-confirmed{background:#6393d1;color:#fff;}
Â  Â  .status-pending{background:#b6ccd7;color:#112947;}
Â  Â  .register-btn{width:100%;padding:0.75rem;background:linear-gradient(135deg,#eeba2b 0%,#f8e185 100%);color:#112947;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;}
Â  Â  .register-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px #eeba2b66;}
Â  Â  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center;}
Â  Â  .modal.active{display:flex;}
Â  Â  .modal-content{background:#fff;border-radius:16px;padding:2rem;max-width:400px;width:90%;box-shadow:0 20px 60px #0000004d;display:flex;flex-direction:column;align-items:center;}
Â  Â  .modal-content form{width:100%;display:flex;flex-direction:column;align-items:center;}
Â  Â  .modal-form-group{width:100%;max-width:260px;margin:0 auto 1.1em auto;}
Â  Â  .modal-form-label{display:block;margin-bottom:0.35em;font-weight:600;color:#112947;font-size:1em;text-align:left;}
Â  Â  .modal-form-input{width:100%;padding:0.65em;border:2px solid #b6ccd7;border-radius:7px;font-size:1em;box-sizing:border-box;}
Â  Â  .modal-form-input:focus{outline:none;border-color:#6393d1;}
Â  Â  .modal-actions{display:flex;gap:1rem;margin-top:1.5rem;}
Â  Â  .modal-btn{flex:1;padding:0.75rem;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;}
Â  Â  .modal-btn-primary{background:linear-gradient(135deg,#eeba2b 0%,#f8e185 100%);color:#112947;}
Â  Â  .modal-btn-secondary{background:#b6ccd7;color:#112947;}
Â  Â  .toast{position:fixed;bottom:2rem;right:2rem;background:#fff;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 4px 12px #00000026;display:none;align-items:center;gap:0.75rem;z-index:2000;transition:opacity 0.3s;}
Â  Â  .toast.active{display:flex; opacity:1;}
Â  Â  .toast.success{border-left:4px solid #48bb78; color:#38a169;}
Â  Â  .toast.error{border-left:4px solid #f56565; color:#e53e3e;}
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  <img class="logo-image" src="https://raw.githubusercontent.com/Repeat7788/BoardGamePlatform/main/for_logo.png" alt="æœªä¾†å°èˆªå•†å“ç…§">
Â  Â  Â  Â  <div class="title-section">
Â  Â  Â  Â  Â  <h1 id="pageTitle">äººé¡åœ–æ¡ŒéŠã€Œæœªä¾†å°èˆªã€<br><span style="letter-spacing:.2em;">æªåœ˜ç¥å™¨</span></h1>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <p class="description" id="pageDescription">
Â  Â  Â  Â  å…¨çƒé¦–æ¬¾çµåˆäººé¡åœ–åŸç†çš„äº’å‹•æ¡ŒéŠã€‚ã€Šæœªä¾†å°èˆªã€‹è®“ä½ é€ééŠæˆ²è‡ªç„¶ç†è§£äººé¡åœ–ã€å­¸æœƒé¸æ“‡ã€ç·´ç¿’æ±ºç­–æµç¨‹ã€‚<br>
Â  Â  Â  Â  é‚€ä½ ä¸€èµ·æªåœ˜é«”é©—ï¼Œå¦‚æœä½ é‚„æ²’åƒåŠ éï¼Œåƒè¬ä¸è¦éŒ¯éå…¨æ–°å­¸ç¿’æ–¹å¼ï¼
Â  Â  Â  </p>
Â  Â  Â  <p class="subtitle" id="pageSubtitle">é¸æ“‡æ™‚æ®µæªåœ˜ï¼ŒæˆåŠŸæˆåœ˜å¾Œå°‡æ”¶åˆ° Email é€šçŸ¥ä¸¦é€²è¡Œå ±åä»˜æ¬¾ã€‚</p>
Â  Â  Â  <p id="updateTime" class="updatetime">æœ€å¾Œæ›´æ–°ï¼š----/--/--, --:--</p>
Â  Â  </div>
Â  Â  <div class="content">
Â  Â  Â  <div class="process-section">
Â  Â  Â  Â  <h2 class="process-title">ğŸ“‹ æªåœ˜æµç¨‹èªªæ˜</h2>
Â  Â  Â  Â  <div class="process-steps">
Â  Â  Â  Â  Â  <div class="step"><div class="step-number">1</div><div class="step-content"><h3>é»æ“ŠåƒåŠ </h3><p>å¡«å¯« Email èˆ‡é¡¯ç¤ºåç¨±</p></div></div>
Â  Â  Â  Â  Â  <div class="step"><div class="step-number">2</div><div class="step-content"><h3>Email ç¢ºèªå ±å</h3><p>ç³»çµ±æ¨æ’­æœ€æ–°ç‹€æ…‹</p></div></div>
Â  Â  Â  Â  Â  <div class="step"><div class="step-number">3</div><div class="step-content"><h3>æ­£å¼å ±åç¹³è²»</h3><p>åƒåŠ è€…æœƒæ”¶åˆ°Tallyè¡¨å–®/ä»˜æ¬¾é€£çµ</p></div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div id="courseGrid" class="course-grid">
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â Â 
Â  <div id="registerModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <div class="modal-header" style="font-size:1.25rem;font-weight:700;color:#0f4392;margin-bottom:1rem;">åƒåŠ æªåœ˜</div>
Â  Â  Â Â 
Â  Â  Â  <form id="registerForm">
Â  Â  Â  Â  <div style="margin-bottom:.8em;text-align:center;color:#112947;font-size:1.00em;">
Â  Â  Â  Â  Â  <p style="margin:0 0 .45em 0">è«‹å¡«å¯«å§“åèˆ‡emailï¼Œé€å‡ºå¾Œå³å®Œæˆæ„é¡˜ç™»è¨˜ã€‚</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="modal-form-group">
Â  Â  Â  Â  Â  <label for="inputEmail" class="modal-form-label">Emailï¼ˆå ±åé€šçŸ¥å°‡å¯„è‡³æ­¤ä¿¡ç®±ï¼‰*</label>
Â  Â  Â  Â  Â  <input id="inputEmail" class="modal-form-input" type="email" maxlength="80" required placeholder="your@email.com" autocomplete="email">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="modal-form-group">
Â  Â  Â  Â  Â  <label for="inputDisplayName" class="modal-form-label">èª²å ‚ç¨±å‘¼ï¼ˆé¸å¡«ï¼Œæ–¹ä¾¿é€šçŸ¥ï¼‰</label>
Â  Â  Â  Â  Â  <input id="inputDisplayName" class="modal-form-input" type="text" maxlength="50" placeholder="ä¾‹å¦‚ï¼šæ¡ŒéŠå°å¤©ä½¿">
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <input type="hidden" id="courseIdInput" name="courseId">

Â  Â  Â  Â  <div class="modal-actions">
Â  Â  Â  Â  Â  <button type="button" class="modal-btn modal-btn-secondary" id="cancelBtn">å–æ¶ˆ</button>
Â  Â  Â  Â  Â  <button type="submit" class="modal-btn modal-btn-primary" id="submitBtn">ç¢ºèªé€å‡ºæ„é¡˜</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </div>
Â  </div>
Â Â 
Â  <div id="toast" class="toast"><span id="toastMessage"></span></div>

<script>
Â  Â  // ã€è«‹ä¿®æ”¹é€™è£¡ï¼ã€‘æ‚¨çš„ n8n Webhook URL (ç”¨æ–¼æ¥æ”¶å ±åè³‡æ–™)
Â  Â  const ENROLL_WEBHOOK_URL = 'https://repeat-taxi.app.n8n.cloud/webhook/group-register';Â 
Â  Â  // Vercel Serverless Function API ç¶²å€ (ç”¨æ–¼å–å¾—å³æ™‚çµ±è¨ˆäººæ•¸)
Â  Â  const COUNT_API_URL = '/api/count';Â 

Â  Â  // æˆåœ˜äººæ•¸é–€æª» (å¯ä»¥æ ¹æ“šæ‚¨çš„èª²ç¨‹éœ€æ±‚èª¿æ•´)
Â  Â  const MIN_ATTENDEES = 3;Â 

Â  Â  // æ¨¡æ“¬èª²ç¨‹æ•¸æ“š (æœƒè¢« API æ•¸æ“šè¦†è“‹)
Â  Â  // *** ä¿®æ­£: å°‡ ID æ›´æ”¹ç‚ºæ•¸å­—å­—ä¸² (1, 2, 3)ï¼Œä»¥åŒ¹é… api/count.js çš„æ¨¡æ“¬æ•¸æ“š Key ***
Â  Â  let coursesData = [
Â  Â  Â  { id: '1', name: 'å¹³æ—¥ä¸‹åˆå ´', time: '14:00-17:00', date: '11/10 (æ—¥)', location: 'å°åŒ—', currentCount: 0, minParticipants: MIN_ATTENDEES },
Â  Â  Â  { id: '2', name: 'å¹³æ—¥æ™šä¸Šå ´', time: '19:00-22:00', date: '11/12 (äºŒ)', location: 'å°åŒ—', currentCount: 0, minParticipants: MIN_ATTENDEES },
Â  Â  Â  { id: '3', name: 'å‡æ—¥ä¸‹åˆå ´', time: '14:00-17:00', date: '11/15 (å…­)', location: 'å°ä¸­', currentCount: 0, minParticipants: MIN_ATTENDEES }
Â  Â  ];
Â  Â  let selectedCourse = null;


Â  Â  // --- è¼”åŠ©å‡½å¼ ---

Â  Â  function updateBannerTime() {
Â  Â  Â  const now = new Date();
Â  Â  Â  const yyyy = now.getFullYear();
Â  Â  Â  const MM = String(now.getMonth() + 1).padStart(2, '0');
Â  Â  Â  const dd = String(now.getDate()).padStart(2, '0');
Â  Â  Â  const hh = String(now.getHours()).padStart(2, '0');
Â  Â  Â  const mm = String(now.getMinutes()).padStart(2, '0');
Â  Â  Â  document.getElementById('updateTime').textContent = `æœ€å¾Œæ›´æ–°ï¼š${yyyy}/${MM}/${dd}, ${hh}:${mm}`;
Â  Â  }

Â  Â  function showToast(message, type = 'success') {
Â  Â  Â  const toast = document.getElementById('toast');
Â  Â  Â  document.getElementById('toastMessage').textContent = message;
Â  Â  Â  toast.className = `toast ${type} active`;
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  toast.className = 'toast';
Â  Â  Â  }, 3000); // é¡¯ç¤º 3 ç§’
Â  Â  }
Â  Â Â 
Â  Â  // --- æ¸²æŸ“èˆ‡ç‹€æ…‹æ›´æ–° ---

Â  Â  function renderCourses() {
Â  Â  Â  const grid = document.getElementById('courseGrid');
Â  Â  Â  grid.innerHTML = '';
Â  Â  Â  coursesData.forEach(course => {
Â  Â  Â  Â  const count = course.currentCount || 0;
Â  Â  Â  Â  const minParticipants = course.minParticipants || MIN_ATTENDEES;
Â  Â  Â  Â  const isConfirmed = count >= minParticipants;
Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  card.className = 'course-card';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ç‹€æ…‹æ–‡å­—
Â  Â  Â  Â  let statusText;
Â  Â  Â  Â  let statusClass;
Â  Â  Â  Â  if (isConfirmed) {
Â  Â  Â  Â  Â  Â  statusText = 'âœ“ å·²æˆåœ˜';
Â  Â  Â  Â  Â  Â  statusClass = 'status-confirmed';
Â  Â  Â  Â  } else if (count > 0) {
Â  Â  Â  Â  Â  Â  statusText = `é‚„å·® ${minParticipants - count} äººæˆåœ˜`;
Â  Â  Â  Â  Â  Â  statusClass = 'status-pending';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  statusText = `å°šç„¡å ±å`;
Â  Â  Â  Â  Â  Â  statusClass = 'status-pending'; // å¯ä»¥ä½¿ç”¨ä¸åŒçš„ pending æ¨£å¼
Â  Â  Â  Â  }

Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  <div class="course-time">${course.date}ï½œ${course.time}</div>
Â  Â  Â  Â  Â  <div class="course-name" style="font-weight:600;color:#112947;margin-bottom: 0.75rem;">
Â  Â  Â  Â  Â  Â  ${course.location}ï½œ${course.name}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="participant-count">
Â  Â  Â  Â  Â  Â  <span>ğŸ‘¥ ç›®å‰æªåœ˜ï¼š</span>
Â  Â  Â  Â  Â  Â  <span class="count-number" id="count-${course.id}">${count}</span>
Â  Â  Â  Â  Â  Â  <span>äºº</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="status-badge ${statusClass}" id="status-${course.id}">
Â  Â  Â  Â  Â  Â  ${statusText}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="register-btn" data-course-id="${course.id}">æˆ‘è¦åƒåŠ </button>
Â  Â  Â  Â  `;
Â  Â  Â  Â  // ç¶å®šé»æ“Šäº‹ä»¶
Â  Â  Â  Â  card.querySelector('.register-btn').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  const courseId = e.target.dataset.courseId;
Â  Â  Â  Â  Â  Â  const course = coursesData.find(c => c.id === courseId);
Â  Â  Â  Â  Â  Â  if (course) {
Â  Â  Â  Â  Â  Â  Â  Â  openRegisterModal(course);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  grid.appendChild(card);
Â  Â  Â  });
Â  Â  }

Â  Â  async function fetchAndUpdateCounts() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // å¾ Vercel éƒ¨ç½²çš„ Serverless Function å–å¾—æ¨¡æ“¬ Notion çµ±è¨ˆæ•¸æ“š
Â  Â  Â  Â  Â  Â  const response = await fetch(COUNT_API_URL);Â 
Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  // å¦‚æœ API å¤±æ•—ï¼Œåƒ…åœ¨ Console ä¸­å ±éŒ¯ï¼Œä¸å½±éŸ¿å‰ç«¯ UI é¡¯ç¤º
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('ç„¡æ³•å¾ API å–å¾—äººæ•¸çµ±è¨ˆ');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const data = await response.json();Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!data.counts || typeof data.counts !== 'object') {
Â  Â  Â  Â  Â  Â  Â  Â  Â throw new Error('API å›å‚³çš„è³‡æ–™çµæ§‹éŒ¯èª¤');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const counts = data.counts;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // éæ­· coursesDataï¼Œæ›´æ–° currentCount
Â  Â  Â  Â  Â  Â  coursesData = coursesData.map(course => {
Â  Â  Â  Â  Â  Â  Â  Â  // ä½¿ç”¨ course.id (ç¾åœ¨æ˜¯ '1', '2', '3') ä¾†æŸ¥æ‰¾ counts ç‰©ä»¶ä¸­çš„äººæ•¸
Â  Â  Â  Â  Â  Â  Â  Â  const count = counts[course.id] !== undefined ? parseInt(counts[course.id]) : course.currentCount;
Â  Â  Â  Â  Â  Â  Â  Â  // æ›´æ–°è©²å¡ç‰‡çš„ DOM å…ƒç´ 
Â  Â  Â  Â  Â  Â  Â  Â  const countElement = document.getElementById(`count-${course.id}`);
Â  Â  Â  Â  Â  Â  Â  Â  const statusElement = document.getElementById(`status-${course.id}`);

Â  Â  Â  Â  Â  Â  Â  Â  if (countElement && statusElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countElement.textContent = count;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const minParticipants = course.minParticipants || MIN_ATTENDEES;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isConfirmed = count >= minParticipants;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.classList.remove('status-confirmed', 'status-pending');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isConfirmed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.textContent = 'âœ“ å·²æˆåœ˜';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.classList.add('status-confirmed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (count > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.textContent = `é‚„å·® ${minParticipants - count} äººæˆåœ˜`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.classList.add('status-pending');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.textContent = `å°šç„¡å ±å`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusElement.classList.add('status-pending');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return { ...course, currentCount: count };
Â  Â  Â  Â  Â  Â  });
            
            // æ›´æ–° coursesData å¾Œï¼Œé‡æ–°æ¸²æŸ“æ•´å€‹ç¶²æ ¼
            renderCourses();

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error('Error fetching and updating counts:', error);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('[id^="count-"]').forEach(el => el.textContent = 'ERR');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Modal é‚è¼¯ ---

Â  Â  function openRegisterModal(course) {
Â  Â  Â  selectedCourse = course;
Â  Â  Â  document.getElementById('registerModal').classList.add('active');
Â  Â  Â  document.querySelector('.modal-header').textContent = `åƒåŠ æªåœ˜ - ${course.date} ${course.location} ${course.name}`;
Â  Â  Â  document.body.style.overflow = 'hidden';
Â  Â  Â  document.getElementById('registerForm').reset();
Â  Â  Â  document.getElementById('courseIdInput').value = course.id; // è¨­å®šéš±è—æ¬„ä½å€¼
Â  Â  Â  document.getElementById('submitBtn').disabled = false;
Â  Â  Â  document.getElementById('submitBtn').textContent = 'ç¢ºèªé€å‡ºæ„é¡˜';
Â  Â  }

Â  Â  function closeRegisterModal() {
Â  Â  Â  document.getElementById('registerModal').classList.remove('active');
Â  Â  Â  selectedCourse = null;
Â  Â  Â  document.body.style.overflow = '';
Â  Â  }

Â  Â  // å ±åè¡¨å–®æäº¤ (ç›´æ¥ POST åˆ° n8n Webhook)
Â  Â  document.getElementById('registerForm').onsubmit = async function(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â Â 
Â  Â  Â  const email = document.getElementById('inputEmail').value.trim();
Â  Â  Â  const displayName = document.getElementById('inputDisplayName').value.trim() || 'åŒ¿åç”¨æˆ¶';Â 
Â  Â  Â  const courseId = document.getElementById('courseIdInput').value;

Â  Â  Â  const submitBtn = document.getElementById('submitBtn');
Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  submitBtn.textContent = 'é€å‡ºä¸­... è«‹ç¨å€™';
Â  Â  Â Â 
Â  Â  Â  const payload = {
Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  displayName: displayName,Â 
Â  Â  Â  Â  Â  courseId: courseId,
Â  Â  Â  Â  Â  source: 'WebForm' // æ¨™è¨˜ä¾†æº
Â  Â  Â  };

Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(ENROLL_WEBHOOK_URL, {
Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  showToast('âœ… å ±åæˆåŠŸï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼Œè«‹ç•™æ„ Email æ”¶å–å¾ŒçºŒé€šçŸ¥ã€‚', 'success');
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  // æˆåŠŸå¾Œå»¶é²é—œé–‰ modalï¼Œä¸¦æ›´æ–°äººæ•¸
Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  closeRegisterModal();
Â  Â  Â  Â  Â  Â  Â  Â  Â  // å ±åæˆåŠŸå¾Œï¼Œè®“å‰ç«¯ç¨å¾®ç­‰å¾… 1.5 ç§’å†æ›´æ–°äººæ•¸ï¼Œç¢ºä¿å¾Œç«¯ n8n æœ‰æ™‚é–“æ›´æ–° Notion
Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(fetchAndUpdateCounts, 1000);Â 
Â  Â  Â  Â  Â  Â  Â  }, 1500);Â 

Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  const errorText = await response.text();
Â  Â  Â  Â  Â  Â  Â  console.error('Webhook Error:', errorText);
Â  Â  Â  Â  Â  Â  Â  showToast('âŒ å ±åå¤±æ•—ã€‚å¾Œå°éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡ã€‚', 'error');
Â  Â  Â  Â  Â  Â  Â  submitBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  submitBtn.textContent = 'ç¢ºèªé€å‡ºæ„é¡˜';
Â  Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error('Fetch Error:', error);
Â  Â  Â  Â  Â  showToast('âŒ ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚', 'error');
Â  Â  Â  Â  Â  submitBtn.disabled = false;
Â  Â  Â  Â  Â  submitBtn.textContent = 'ç¢ºèªé€å‡ºæ„é¡˜';
Â  Â  Â  }
Â  Â  };


Â  Â  // --- åˆå§‹åŒ–èˆ‡äº‹ä»¶ç¶å®š ---

Â  Â  document.getElementById('cancelBtn').onclick = closeRegisterModal;
Â  Â  document.getElementById('registerModal').onclick = function(e) {
Â  Â  Â  if(e.target === this) closeRegisterModal();
Â  Â  };


Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  // 1. æ¸²æŸ“å¡ç‰‡ (ç¬¬ä¸€æ¬¡æ¸²æŸ“ä½¿ç”¨æœ¬åœ°çš„ currentCount: 0)
Â  Â  Â  Â  renderCourses();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. ç«‹å³å–å¾—ä¸¦æ›´æ–°äººæ•¸
Â  Â  Â  Â  fetchAndUpdateCounts();

Â  Â  Â  Â  // 3. è¨­å®šå®šæ™‚æ›´æ–° (æ¯ 10 ç§’)
Â  Â  Â  Â  setInterval(fetchAndUpdateCounts, 10000);Â 

Â  Â  Â  Â  // 4. æ›´æ–°é é¢æ™‚é–“
Â  Â  Â  Â  updateBannerTime();
Â  Â  Â  Â  setInterval(updateBannerTime, 60000); // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡æ™‚é–“
Â  Â  });

</script>
</body>
</html>
